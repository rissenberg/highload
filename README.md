# Highload VK

## Содержание
  #### [1. Тема и целевая аудитория](#topic)
  #### [2. Диверсификация](#diversification)
  #### [3. Расчет нагрузки](#load)
  #### [4. Источники](#source)

<a name="topic"></a>
## 1. Тема и целевая аудитория 

### Тема
VK - Развлекательная социальная сеть, позволяющая создавать, 

### MVP
- Публикация записей на стене пользователя
- Лайки и комментарии к постам
- Создание сообществ
- Лента новостей пользователя. Обычная и умная ленты
- Мои фото, Мои видео, Моя музыка

### Целевая аудитория  
- Страны СНГ.
- Пользователи:
	-  MAU 100 млн \[[1](https://vk.com/about)]
	-  DAU 76 млн \[[2](https://vk.company/ru/investors/info/11642/)]
- Распределение аудитории по странам \[[3](https://inclient.ru/vk-stats/#lwptoc2)]
  - Россия - 84,4%
  - Беларусь - 3%
  - Казахстан - 2,1%
  - Украина - 1,1%
  - Другие - 9,4%

<a name="diversification"></a>
## 2. Диверсификация 

Сервис ВК по своему функционалу схож с сервисами Твиттер, но за обоими сервисами стоят разные цели - первый, ВК, является популярным развлекательным сервисом с широким спектром контента, в то время как Твиттер ориентирован на быстрый и краткий обмен новостями, мнениями и информацией. Именно различие в целях задает различия и в функционале, предоставляемому пользователям, и в аудитории, для которой сервис был создан.

### Формирование функциональных различий

#### Посты

Функционал, что разделяют ВК и Твиттер - лента, в которой пользователь может просматривать новые посты/твиты из источников, на которые он подписан. Чтобы сформировать различия сервисов, нужно начать с самих постов - в Твиттере они представляют из себя небольшие сообщения ограниченные 280 символами, с возможностью прикрепить к записи фото (до 4 шт) или видео (1 шт с доп ограничением по длительности). В свою очередь ВК имеет ограничения намного большие: 4096 символов на пост, 10 медиафайлов - фотографий, видео- и аудиозаписей.

#### Источники

Теперь мы разберем то, откуда контент попадает в новостную ленту - источники. Для Твиттера единственным источником являются профили пользователей - их блоги. На кого подписан пользователь - их же посты он и будет видеть в своей ленте. В ВК помимо записей на стене пользователей существуют сообщества - блоги, не связанные с профилем автора и предоставляющие новый функционал, не встречающийся в профилях ВК и Твиттера - например, разделение права администрирования сообщества между несколькими людьми, добавление новых ролей - модератора и редактора, закрытые сообщества дают возможность приглашать в них только определенный круг людей, и, в конечном итоге, сообщества позволяют одному человеку создавать и вести несколько блогов, оставаясь при этом в одном аккаунте.

#### Подписка на источники

Источники, публикуя новые записи/посты/твиты, формируют новостную ленту своих подписчиков, таким образом, чтобы пользователь начал получать новости из источника, необходима подписка на него. В Твиттере пользователь может начать "читать" другого - тем самым оформив подписку на новости. По тому же принципу работают остальные микроблогинговые сервисы, например, Инстаграм и Тамблер. В ВК действует система друзей - пользователь может подать заявку в друзья, и, если второй пользователь ее примет, оба начнут получать новые записи друг друга в своих лентах (в то время как в Твитере подписка "односторонняя"). Подписки на сообщества ВК ничем принципиально не отличаются от подписок в Твиттере - пользователь при вступлении в сообщества "подписывается" на его обновления - и новые записи начинают появляться в ленте подписчика.

#### Файлохранилище

Также стоит добавить об одной функциональной особенности ВК - у каждого пользователя (или сообщества) есть "свои" фотографии, видео, музыка и файлы - в отличие от Твиттера, у этого сервиса есть функционал файлохранилища с доступом к любому загруженному файлу из общей страницы того или иного типа документа, в то время как доступ к файлу в Твиттере возможен лишь через пост, к которому он был прикреплен.

<a name="load"></a>
## 2 Расчёт нагрузки

Ежемесячная аудитория VK: 100 млн. пользователей.

Ежедневная аудитория VK: 76 млн. пользователей.

Согласно исследованию [[3]](https://inclient.ru/vk-stats/):

 - Во ВКонтакте 48 млн активных авторов

 - Во ВКонтакте создано более 2 млн авторских пабликов

 - В среднем пользователь проводит во ВКонтакте 18 минут в день

 - Каждый день пользователи ВКонтакте оставляют 1 млрд отметок «Нравится»

 - Контент во ВКонтакте набирает 10.3 млрд просмотров каждый день

 - Пользователи ВКонтакте просматривают короткие видео 1 млрд раз в день (~ 10% от общего кол-ва просмотров)

### Средняя статистика для пользователя
Посчитаем количество просмотров и лайков в день на одного пользователя : 

	10.3 млрд. / 76 млн. ~ 135 [просм/чел]

	1 млрд. / 76 млн. ~ 13 [лайков/чел]

Предпологаем, что:
* Из 135 постов 13 будут содержать видео и 13 будут текстом без фотографий.
* Средняя длина одного поста равна 200 символам в кодировки UTF-8, где 1 символ равен 1 байту.
* Средний размер одной фотографии из сообщений равен 256 кБ, среднее количество фотографий в посте : 1-5.
* Средняя продолжительность видео - 1 минута, объем видео составляет 7 Мб
* Среднее количество подписок у одного пользователя порядка 100

### Средняя статистика для автора
Посчитаем количество опубликованного контента в день на одного автора : 

В 2022 году во ВКонтакте было опубликовано более 6.3 млрд постов[[3]](https://inclient.ru/vk-stats/). Следовательно, на один день приходится 6.3 млрд. / 365 дней ~ 17,2 млн. [постов/день]

	17,2 млн. / (48 + 2) млн. ~ 0,344 [пост/автор]


### Предварительные расчеты:
Посчитаем объем трафика для просмотра ленты на одного человек за сутки:

	Размер одного поста: 128 кб (размер аватарки сообщества) + 200 б (текст поста) = 129 кб
	
	Размер одного поста с фото: 128 кб (размер аватарки сообщества) + 200 б (текст поста) + 3 * 256 кб (фотографии в посте) = 896 кб
	
	Размер одного поста с видео: 128 кб (размер аватарки сообщества) + 200 б (текст поста) + 7 мб (видео в посте) ~ 7 мб
	
	Трафик для одного пользователя в среднем: 129 кб * 13 просм + 896 кб * 109 просм + 7 мб * 13 просм = 188 Мб


Рассмотрим трафик на сервере по видам постов:


Тип          | Отправка (дневная аудитория 76 млн)   | Отправка Тб/сек |
-------------| -------------| ---------|
Текстовый     | 13 * 76 млн. * 129 кБ / 18*60 сек            		| 0,112           |
   Фотографии     | 109 * 76 млн. * 896 кБ / 18*60 сек                 | 6,550              | 
   Видео    	| 13 * 76 млн. * 6 Мб / 18*60 сек               	 | 5,355             |
   Итого  |                                            			 | 12,017          |

### RPS
 
* Просмотр поста: 10,3 млрд / 86400 = 119 200 RPS
* Лайк поста: 1 млрд / 86400 = 11 575 RPS
* Публикация: 17,2 млн. / 86400 = 200 RPS

Действие                            | RPS
------------------------------------| ---
Просмотр поста                      | 119 200
Лайк поста                          | 11 575
Публикация                          | 200
**Итого**                           | 130 975

Статистики, отражающей пиковое значение активности пользователей сервиса ВКонтаке в интернете нет. Возьмем коэффициент запаса равный 2
Соответственно:

   Тип          | Пиковое значение   | Пиковое значение с коэффициентом запаса 2  |
-------------| -------------| ---------|
RPS     | 130 975             | 261 950            |
   Сетевой трафик(Тб/c)     | 12                 | 24             | 

<a name="source"></a>
## 4. Источники 
  1. https://vk.com/about
  2. https://vk.company/ru/investors/info/11642/
  3. https://inclient.ru/vk-stats/
   
